---
import Layout from "@/layout/Layout.astro";
import SwitchPanel from "@/components/switch_panel.astro";

console.log("power index.astro")
const events_url = import.meta.env.SERVER+'/api/events'
---
<Layout title="Heat" >
	<ul class="power page" data-url={events_url}>
		<li>
			<SwitchPanel name="mesh"/>
		</li>
		<li>
			<SwitchPanel name="lifx"/>
		</li>
		<li>
			<SwitchPanel name="poster"/>
		</li>
		<li>
			<SwitchPanel name="pc"/>
		</li>
	</ul>
</Layout>


<style>
ul{
	display:flex;
	flex-direction: row;
	flex-wrap: wrap;
	justify-content: center;
	gap: 10px;
	list-style: none;
	padding: 0px;
}
li{
	border-radius: 10px;
	background-color:rgb(112, 112, 112);
	overflow: hidden;
    box-shadow: 2px 1px 10px rgb(123, 123, 123);
}
li:hover{
	box-shadow: 4px 5px 5px #ccc;
}

</style>

<script>
	function setup_sse(){
		const ul = document.querySelector(".power.page")
		const evtSource = new EventSource(ul.getAttribute("data-url"))
	
		evtSource.onmessage = (event) => {
			console.log("Event source")
			console.log(event.data)
		}
		evtSource.onerror = (err) => {
			  console.error("EventSource failed:", err);
			  evtSource.close();
		};	
	}
</script>
